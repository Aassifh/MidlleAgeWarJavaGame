package Game;

import java.awt.Canvas;
import java.awt.Point;
import java.awt.Rectangle;
import java.util.Random;
import java.util.Vector;

import Game.entities.*;
import Game.rules.PowerRule;
import Game.rules.UnitMoveBlockers;
import Game.rules.UnitOverlapRules;
import gameframework.core.CanvasDefaultImpl;
import gameframework.core.Game;
import gameframework.core.GameLevelDefaultImpl;
import gameframework.core.GameMovable;
import gameframework.core.GameMovableDriverDefaultImpl;
import gameframework.core.GameUniverseDefaultImpl;
import gameframework.core.GameUniverseViewPortDefaultImpl;
import gameframework.moves_rules.MoveBlockerChecker;
import gameframework.moves_rules.MoveBlockerCheckerDefaultImpl;
import gameframework.moves_rules.MoveStrategyKeyboard;
import gameframework.moves_rules.MoveStrategyRandom;
import gameframework.moves_rules.MoveStrategyStraightLine;
import gameframework.moves_rules.OverlapProcessor;
import gameframework.moves_rules.OverlapProcessorDefaultImpl;
import soldier.ages.AgeFutureFactory;
import soldier.ages.AgeMiddleFactory;
import soldier.core.AgeAbstractFactory;
import soldier.core.Unit;
import soldier.core.UnitGroup;
import soldier.core.UnitSimple;
import soldier.units.UnitCenturion;
import soldier.units.UnitHorseMan;
import soldier.units.UnitRobot;


public class GameUnitLevelOne extends GameLevelDefaultImpl{
	Canvas canvas;
	static int[][] tab = {
			{ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 8, 8, 8, 8, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 0, 0, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 0, 0, 5, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 1 },
			{ 1, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
			{ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 } };
	
	public static final int SPRITE_SIZE = 15;
	public static final int ENNEMI = 5;
	
	protected void init() {
		OverlapProcessor overlapProcessor = new OverlapProcessorDefaultImpl();
		MoveBlockerChecker moveBlockerChecker = new MoveBlockerCheckerDefaultImpl();
		
		moveBlockerChecker.setMoveBlockerRules(new UnitMoveBlockers());
		
		UnitOverlapRules overlapRules = new UnitOverlapRules(new Point(14*SPRITE_SIZE, 17*SPRITE_SIZE),new Point(14*SPRITE_SIZE, 17*SPRITE_SIZE), life[0],score[0],endOfGame);
		overlapProcessor.setOverlapRules(overlapRules);
		universe = new GameUniverseDefaultImpl(moveBlockerChecker, overlapProcessor);
		overlapRules.setCanvas(canvas);
		overlapRules.setUniverse(universe);
		overlapRules.setMoveBlockerChecker(moveBlockerChecker);
		gameBoard = new GameUniverseViewPortDefaultImpl(canvas, universe);
		((CanvasDefaultImpl) canvas).setDrawingGameBoard(gameBoard);
		// remplissage de l'univers par des sprites
		
		for (int i = 0; i < 31; i++) {
			for (int j = 0; j < 28; j++) {
				
				if (tab[i][j] == 3) {
					universe.addGameEntity(new tresor(canvas, new Point(j * SPRITE_SIZE, i * SPRITE_SIZE)));
				}
				if (tab[i][j] == 1) {
					universe.addGameEntity(new Wall(canvas, (j+1) * SPRITE_SIZE, (i+1) * SPRITE_SIZE));
				}
				
				
			}
		}
		
		// aprÃ¨s definition des trucs qui bougent
		// soldats /ennemi etc..
		
		AgeAbstractFactory fact = AgeFutureFactory.getInstance();
		UnitGroup Myarmy = new UnitGroup("MyArmy");
		UnitRobot unit=(UnitRobot) fact.infantryUnit(canvas, "MyROBOT");
		Myarmy.addUnit(unit);
		GameMovableDriverDefaultImpl UnitDriver= new GameMovableDriverDefaultImpl();
		MoveStrategyKeyboard KeyStr = new MoveStrategyKeyboard();
		UnitDriver.setStrategy(KeyStr);
		UnitDriver.setmoveBlockerChecker(moveBlockerChecker);
		canvas.addKeyListener(KeyStr);
		unit.setDriver(UnitDriver);
		unit.setPosition(new Point(13*SPRITE_SIZE,27*SPRITE_SIZE));
		universe.addGameEntity(unit);
		
		

		// Ajout des Ennemi 
			fact = AgeMiddleFactory.getInstance();
			UnitGroup army= new UnitGroup("army");
			UnitCenturion unit3=(UnitCenturion) fact.infantryUnit(canvas, "Centurion");
			army.addUnit(unit3);
			unit.addObserver(unit3);
			
			unit3.getUnitDriver4().setmoveBlockerChecker(moveBlockerChecker);			
			unit3.setPosition(new Point((14)*SPRITE_SIZE,15*SPRITE_SIZE));
			universe.addGameEntity(unit3);
			
			
			for (int i = 0; i < ENNEMI; i++) {
				UnitHorseMan unit2=(UnitHorseMan) fact.riderUnit(canvas, "HORSEMAN");
				//army.addUnit(unit2);
				GameMovableDriverDefaultImpl UnitDriver1= new GameMovableDriverDefaultImpl();
				MoveStrategyRandom KeyS = new MoveStrategyRandom();
				UnitDriver1.setStrategy(KeyS);
				UnitDriver1.setmoveBlockerChecker(moveBlockerChecker);
				unit2.setDriver(UnitDriver1);
				unit2.setPosition(new Point((10+i)*SPRITE_SIZE,10*SPRITE_SIZE));
				universe.addGameEntity(unit2);
	
			}
			
		
		overlapRules.setEnnemi(army);
		overlapRules.setMyArmy(Myarmy);
		
		PowerRule pr = new PowerRule(universe, canvas, tab);
		pr.start();
		
	}


	public GameUnitLevelOne(Game g) {
		super(g);
		canvas = g.getCanvas();
	}

}
